<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../assets/favicon.png">
    <link rel="stylesheet" href="../css/output.css">
    <link rel="stylesheet" href="../css/input.css">
    <title>Hymns Myanmar</title>
</head>
<body class="bg-[#075C4D] overflow-y-hidden">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="absolute top-0 left-0 hidden w-screen h-screen items-center justify-center bg-[#075C4D] text-[#E2E46E] logo font-bold text-2xl italic">
        <p class="animate-pulse">Hymn Myanmar</p>
    </div>

    <div class="mainContainer p-12 flex flex-col text-white gap-8 items-center justify-center w-screen">
        <ul class="hymns flex items-start justify-center gap-5 flex-col">
        </ul>
        <div class="qrCode"></div>
    </div>

    <script>

        const backendApi = "http://localhost/hymnsmyanmar";

        const getQueryParam = (param) => {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        };

        // Function to fetch hymn details based on hymnId
        const fetchHymns = async (hymnId) => {
            try {
            
                const loadingScreen = document.getElementById("loadingScreen");
                const mainContainer = document.querySelector(".mainContainer");

                loadingScreen.classList.remove("hidden");
                loadingScreen.classList.add("flex");

                const response = await fetch(`${backendApi}/backend/api.php?id=${hymnId}`);
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                const hymns = await response.json();
                document.title = hymns.hymn.burmeseTitle || "Hymns";
                console.log(hymns);

                const container = document.querySelector(".hymns");

                const maxLength = Math.max(hymns.verses.length, hymns.choruses.length);

                for (let i = 0; i < maxLength; i++) {
                    if (i < hymns.verses.length) {
                        container.innerHTML += ` 
                            <li>
                                ${hymns.verses[i].text}
                            </li>
                        `;
                    }
                    if (hymns.choruses !== "N/A" && i < hymns.choruses.length) {
                        container.innerHTML += ` 
                            <li class="chorus">
                                ${hymns.choruses[i].text}
                            </li>
                        `;
                    }
                }
                generateQrCode(`${backendApi}/backend/api.php?id=${hymnId}`);

            } catch (error) {
                console.error("Failed to fetch hymns:", error);
            } finally {
                loadingScreen.classList.add("hidden");
            }
        };

        // Function to generate and display QR code
        const generateQrCode = (data) => {
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(data)}`;
            const qrCodeElement = document.querySelector(".qrCode");
            qrCodeElement.innerHTML = `<img src="${qrCodeUrl}" alt="QR Code" />`;
        };

        // Get the hymn ID from the URL and fetch the hymn details
        const hymnId = getQueryParam('id');
        if (hymnId) {
            fetchHymns(hymnId);
        } else {
            console.error("Hymn ID not found in the URL.");
        }
    </script>
    
</body>
</html>
